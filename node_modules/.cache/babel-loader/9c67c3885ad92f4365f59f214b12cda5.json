{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/terry/UUBC/React/Chess/src/components/game.js\";\n\n/* eslint-disable no-unused-expressions */\nimport React from 'react';\nimport '../index.css';\nimport Board from './board.js';\nimport FallenSoldierBlock from './fallensoldiers';\nimport initialiseChessBoard from '../helpers/initialiseChessBoard';\nexport default class Game extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      squares: initialiseChessBoard(),\n      whiteFallenSoldiers: [],\n      blackFallenSoldiers: [],\n      player: 1,\n      sourceSelection: -1,\n      status: '',\n      turn: 'white',\n      lastTurnPawnPosition: undefined,\n      //true === last turn enemy's pawn moved for the first time and it moved 2 squares forward. for en pasaant\n      firstMove: undefined,\n      highLightMoves: [],\n      allPossibleMovesWhite: [],\n      allPossibleMovesBlack: [],\n      //for castling\n      whiteKingFirstMove: true,\n      blackKingFirstMove: true,\n      whiteRookFirstMoveLeft: true,\n      whiteRookFirstMoveRight: true,\n      blackRookFirstMoveLeft: true,\n      blackRookFirstMoveRight: true\n    };\n  }\n\n  handleClick(i) {\n    let squares = this.state.squares;\n    const highLightMoves = this.state.highLightMoves;\n    console.log(\"left white rook: \" + this.state.whiteRookFirstMoveLeft);\n    console.log(\"right white rook: \" + this.state.whiteRookFirstMoveRight);\n    console.log(\"left black rook: \" + this.state.blackRookFirstMoveLeft);\n    console.log(\"right black rook: \" + this.state.blackRookFirstMoveRight);\n    console.log(\"white king: \" + this.state.whiteKingFirstMove);\n    console.log(\"black king: \" + this.state.blackKingFirstMove);\n    const allPossibleMovesWhite = this.state.allPossibleMovesWhite;\n    console.log(allPossibleMovesBlack);\n\n    for (let i = 0; i < this.state.squares.length; i++) {\n      if (this.state.squares[i] !== null) {\n        if (this.state.squares[i].player === 1) {\n          if (this.state.squares[i].name === \"Pawn\") {\n            let tempArray = this.state.squares[i].possibleCaptureMoves(i, this.state.squares);\n\n            for (let i = 0; i < tempArray.length; i++) {\n              allPossibleMovesWhite.push(tempArray[i]);\n            }\n          } else {\n            let tempArray = this.state.squares[i].possibleMoves(i, this.state.squares);\n\n            for (let i = 0; i < tempArray.length; i++) {\n              allPossibleMovesWhite.push(tempArray[i]);\n            }\n          }\n        }\n      }\n    }\n\n    let x = allPossibleMovesWhite.sort();\n    const temp = [];\n\n    for (let i = 0; i < x.length; i++) {\n      if (x[i] !== x[i + 1]) {\n        temp.push(x[i]);\n        console.log(temp);\n      }\n    }\n\n    this.setState({\n      allPossibleMovesWhite: temp\n    });\n    console.log(this.state.allPossibleMovesWhite);\n    console.log(temp);\n\n    if (this.state.sourceSelection === -1) {\n      if (!squares[i] || squares[i].player !== this.state.player) {\n        this.setState({\n          status: \"Wrong selection. Choose player \" + this.state.player + \" pieces.\"\n        });\n        squares[i] ? squares[i].style = { ...squares[i].style,\n          backgroundColor: \"\"\n        } : null;\n      } else {\n        //highlight selected piece\n        squares[i].style = { ...squares[i].style,\n          backgroundColor: \"RGB(111,143,114)\"\n        }; // Emerald from http://omgchess.blogspot.com/2015/09/chess-board-color-schemes.html\n        //highlight possible moves\n\n        let temp;\n\n        if (squares[i].name === \"Pawn\") {\n          const enpassant = this.enpassant(i);\n          temp = squares[i].possibleMoves(i, squares, enpassant, this.state.lastTurnPawnPosition);\n        } else {\n          temp = squares[i].possibleMoves(i, squares);\n        }\n\n        for (let index = 0; index < temp.length; index++) {\n          const element = temp[index];\n          highLightMoves.push(element);\n        }\n\n        for (let index = 0; index < highLightMoves.length; index++) {\n          const element = highLightMoves[index];\n\n          if (squares[element] !== null) {\n            squares[element].style = { ...squares[element].style,\n              backgroundColor: \"RGB(111,143,114)\"\n            };\n          } else {\n            squares.splice(element, 1, {\n              style: {\n                backgroundColor: \"RGB(111,143,114)\"\n              }\n            });\n          }\n        }\n\n        this.setState({\n          squares: squares,\n          status: \"Choose destination for the selected piece\",\n          sourceSelection: i,\n          highLightMoves: highLightMoves\n        });\n      }\n    } else if (this.state.sourceSelection > -1) {\n      //dehighlight selected piece\n      squares[this.state.sourceSelection].style = { ...squares[this.state.sourceSelection].style,\n        backgroundColor: \"\"\n      };\n      const whiteFallenSoldiers = this.state.whiteFallenSoldiers;\n      const blackFallenSoldiers = this.state.blackFallenSoldiers;\n\n      if (squares[this.state.sourceSelection].name === \"Pawn\") {\n        squares = this.dehighlight(squares);\n        const enpassant = this.enpassant(this.state.sourceSelection);\n\n        if (this.state.highLightMoves.includes(i)) {\n          //if en passant is available and player decided to use it, else proceed without it\n          if (enpassant && squares[i] == null && (this.state.lastTurnPawnPosition - 8 === i || this.state.lastTurnPawnPosition + 8 === i)) {\n            //remove captured piece border color and add it to fallen soldier list\n            if (squares[this.state.lastTurnPawnPosition].player === 1) {\n              squares[this.state.lastTurnPawnPosition].style = { ...squares[this.state.lastTurnPawnPosition].style,\n                borderColor: \"transparent\"\n              };\n              whiteFallenSoldiers.push(squares[this.state.lastTurnPawnPosition]);\n            } else {\n              squares[this.state.lastTurnPawnPosition].style = { ...squares[this.state.lastTurnPawnPosition].style,\n                borderColor: \"transparent\"\n              };\n              blackFallenSoldiers.push(squares[this.state.lastTurnPawnPosition]);\n            } //move player selected piece to target position\n\n\n            squares[i] = squares[this.state.sourceSelection];\n            squares[this.state.lastTurnPawnPosition] = null;\n            squares[this.state.sourceSelection] = null;\n            this.changeTurn();\n            this.setState({\n              sourceSelection: -1,\n              squares: squares,\n              whiteFallenSoldiers: whiteFallenSoldiers,\n              blackFallenSoldiers: blackFallenSoldiers,\n              status: '',\n              highLightMoves: []\n            });\n          } else {\n            //check if current pawn is moving for the first time and moving 2 squares forward\n            let firstMove;\n\n            if (squares[this.state.sourceSelection].name === \"Pawn\") {\n              if (squares[this.state.sourceSelection].player === 1 && i === this.state.sourceSelection - 16) {\n                firstMove = true;\n              } else if (squares[this.state.sourceSelection].player === 2 && i === this.state.sourceSelection + 16) {\n                firstMove = true;\n              }\n            } //record current pawn position for next turn to check en passant rule\n\n\n            let lastTurnPawnPosition = i;\n            this.addToFallenSoldierList(i, squares, whiteFallenSoldiers, blackFallenSoldiers);\n            squares = this.movePiece(i, squares);\n            this.changeTurn();\n            this.setState({\n              sourceSelection: -1,\n              squares: squares,\n              status: '',\n              firstMove: firstMove,\n              lastTurnPawnPosition: lastTurnPawnPosition,\n              highLightMoves: []\n            });\n          }\n        } else {\n          this.wrongMove(squares, \"Wrong selection. Choose valid source and destination again.\");\n        }\n      } else if (squares[this.state.sourceSelection].name === \"King\") {\n        squares = this.dehighlight(squares);\n\n        if (this.state.highLightMoves.includes(i)) {\n          this.addToFallenSoldierList(i, squares, whiteFallenSoldiers, blackFallenSoldiers);\n          squares = this.movePiece(i, squares);\n          this.changeTurn(); //to record king has been moved or not. for castling\n\n          let whiteKingFirstMove = this.state.whiteKingFirstMove;\n          let blackKingFirstMove = this.state.blackKingFirstMove;\n\n          if (squares[i].name === \"King\" && this.state.sourceSelection === 60 && squares[i].player === 1) {\n            whiteKingFirstMove = false;\n          }\n\n          if (squares[i].name === \"King\" && this.state.sourceSelection === 4 && squares[i].player === 2) {\n            blackKingFirstMove = false;\n          }\n\n          this.setState({\n            sourceSelection: -1,\n            squares: squares,\n            status: '',\n            highLightMoves: [],\n            whiteKingFirstMove: whiteKingFirstMove,\n            blackKingFirstMove: blackKingFirstMove\n          });\n        } else {\n          this.wrongMove(squares, \"Wrong selection. Choose valid source and destination again.\");\n        }\n      } else {\n        squares = this.dehighlight(squares);\n\n        if (this.state.highLightMoves.includes(i)) {\n          this.addToFallenSoldierList(i, squares, whiteFallenSoldiers, blackFallenSoldiers);\n          squares = this.movePiece(i, squares);\n          this.changeTurn(); //to record if rook has been moved or not. for castling.\n\n          let whiteRookFirstMoveLeft = this.state.whiteRookFirstMoveLeft;\n          let whiteRookFirstMoveRight = this.state.whiteRookFirstMoveRight;\n          let blackRookFirstMoveLeft = this.state.blackRookFirstMoveLeft;\n          let blackRookFirstMoveRight = this.state.blackRookFirstMoveRight;\n\n          if (squares[i].name === \"Rook\" && this.state.sourceSelection === 56 && squares[i].player === 1) {\n            whiteRookFirstMoveLeft = false;\n          }\n\n          if (squares[i].name === \"Rook\" && this.state.sourceSelection === 63 && squares[i].player === 1) {\n            whiteRookFirstMoveRight = false;\n          }\n\n          if (squares[i].name === \"Rook\" && this.state.sourceSelection === 0 && squares[i].player === 2) {\n            blackRookFirstMoveLeft = false;\n          }\n\n          if (squares[i].name === \"Rook\" && this.state.sourceSelection === 7 && squares[i].player === 2) {\n            blackRookFirstMoveRight = false;\n          }\n\n          this.setState({\n            sourceSelection: -1,\n            squares: squares,\n            status: '',\n            highLightMoves: [],\n            whiteRookFirstMoveLeft: whiteRookFirstMoveLeft,\n            whiteRookFirstMoveRight: whiteRookFirstMoveRight,\n            blackRookFirstMoveLeft: blackRookFirstMoveLeft,\n            blackRookFirstMoveRight: blackRookFirstMoveRight\n          });\n        } else {\n          this.wrongMove(squares, \"Wrong selection. Choose valid source and destination again.\");\n        }\n      }\n    }\n  } //to determine if its possible to do en passant capture\n\n\n  enpassant(selectedPawnPosition) {\n    let enpassant = false;\n\n    if (selectedPawnPosition - 1 === this.state.lastTurnPawnPosition || selectedPawnPosition + 1 === this.state.lastTurnPawnPosition) {\n      if (this.state.firstMove) {\n        enpassant = true;\n      }\n    }\n\n    return enpassant;\n  } //dehighlight possible moves\n\n\n  dehighlight(squares) {\n    for (let index = 0; index < this.state.highLightMoves.length; index++) {\n      const element = this.state.highLightMoves[index];\n\n      if (squares[element].name === \"Pawn\" || squares[element].name === \"Knight\" || squares[element].name === \"Rook\" || squares[element].name === \"Bishop\" || squares[element].name === \"Queen\" || squares[element].name === \"King\") {\n        squares[element].style = { ...squares[element].style,\n          backgroundColor: \"\"\n        };\n      } else {\n        squares[element] = null;\n      }\n    }\n\n    return squares;\n  } //remove captured piece border color and add it to fallen soldier list\n\n\n  addToFallenSoldierList(i, squares, whiteFallenSoldiers, blackFallenSoldiers) {\n    if (squares[i] !== null) {\n      if (squares[i].player === 1) {\n        squares[i].style = { ...squares[i].style,\n          borderColor: \"transparent\"\n        };\n        whiteFallenSoldiers.push(squares[i]);\n      } else {\n        squares[i].style = { ...squares[i].style,\n          borderColor: \"transparent\"\n        };\n        blackFallenSoldiers.push(squares[i]);\n      }\n    }\n\n    this.setState({\n      whiteFallenSoldiers: whiteFallenSoldiers,\n      blackFallenSoldiers: blackFallenSoldiers\n    });\n  } //move player selected piece to target position\n\n\n  movePiece(i, squares) {\n    squares[i] = squares[this.state.sourceSelection];\n    squares[this.state.sourceSelection] = null;\n    return squares;\n  }\n\n  changeTurn() {\n    let player = this.state.player === 1 ? 2 : 1;\n    let turn = this.state.turn === 'white' ? 'black' : 'white';\n    this.setState({\n      player: player,\n      turn: turn\n    });\n  } //display message, and reset chess board\n\n\n  wrongMove(squares, status) {\n    this.setState({\n      status: status,\n      sourceSelection: -1,\n      highLightMoves: [],\n      squares: squares\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"game\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"game-board\",\n          children: /*#__PURE__*/_jsxDEV(Board, {\n            squares: this.state.squares,\n            onClick: i => this.handleClick(i)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 329,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"game-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Turn\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"player-turn-box\",\n            style: {\n              backgroundColor: this.state.turn\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"game-status\",\n            children: this.state.status\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 339,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"fallen-soldier-block\",\n            children: /*#__PURE__*/_jsxDEV(FallenSoldierBlock, {\n              whiteFallenSoldiers: this.state.whiteFallenSoldiers,\n              blackFallenSoldiers: this.state.blackFallenSoldiers\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 343,\n              columnNumber: 30\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 341,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"icons-attribution\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\" \", /*#__PURE__*/_jsxDEV(\"small\", {\n            children: [\" Chess Icons And Favicon (extracted) By en:User:Cburnett [\", /*#__PURE__*/_jsxDEV(\"a\", {\n              href: \"http://www.gnu.org/copyleft/fdl.html\",\n              children: \"GFDL\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 354,\n              columnNumber: 92\n            }, this), \", \", /*#__PURE__*/_jsxDEV(\"a\", {\n              href: \"http://creativecommons.org/licenses/by-sa/3.0/\",\n              children: \"CC-BY-SA-3.0\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 354,\n              columnNumber: 149\n            }, this), \", \", /*#__PURE__*/_jsxDEV(\"a\", {\n              href: \"http://opensource.org/licenses/bsd-license.php\",\n              children: \"BSD\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 354,\n              columnNumber: 224\n            }, this), \" or \", /*#__PURE__*/_jsxDEV(\"a\", {\n              href: \"http://www.gnu.org/licenses/gpl.html\",\n              children: \"GPL\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 354,\n              columnNumber: 292\n            }, this), \"], \", /*#__PURE__*/_jsxDEV(\"a\", {\n              href: \"https://commons.wikimedia.org/wiki/Category:SVG_chess_pieces\",\n              children: \"via Wikimedia Commons\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 354,\n              columnNumber: 349\n            }, this), \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 354,\n            columnNumber: 27\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 13\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/terry/UUBC/React/Chess/src/components/game.js"],"names":["React","Board","FallenSoldierBlock","initialiseChessBoard","Game","Component","constructor","state","squares","whiteFallenSoldiers","blackFallenSoldiers","player","sourceSelection","status","turn","lastTurnPawnPosition","undefined","firstMove","highLightMoves","allPossibleMovesWhite","allPossibleMovesBlack","whiteKingFirstMove","blackKingFirstMove","whiteRookFirstMoveLeft","whiteRookFirstMoveRight","blackRookFirstMoveLeft","blackRookFirstMoveRight","handleClick","i","console","log","length","name","tempArray","possibleCaptureMoves","push","possibleMoves","x","sort","temp","setState","style","backgroundColor","enpassant","index","element","splice","dehighlight","includes","borderColor","changeTurn","addToFallenSoldierList","movePiece","wrongMove","selectedPawnPosition","render"],"mappings":";;;AAAA;AACA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,cAAP;AACA,OAAOC,KAAP,MAAkB,YAAlB;AACA,OAAOC,kBAAP,MAA+B,kBAA/B;AACA,OAAOC,oBAAP,MAAiC,iCAAjC;AAEA,eAAe,MAAMC,IAAN,SAAmBJ,KAAK,CAACK,SAAzB,CAAmC;AAC9CC,EAAAA,WAAW,GAAG;AACV;AACA,SAAKC,KAAL,GAAa;AACTC,MAAAA,OAAO,EAAEL,oBAAoB,EADpB;AAETM,MAAAA,mBAAmB,EAAE,EAFZ;AAGTC,MAAAA,mBAAmB,EAAE,EAHZ;AAITC,MAAAA,MAAM,EAAE,CAJC;AAKTC,MAAAA,eAAe,EAAE,CAAC,CALT;AAMTC,MAAAA,MAAM,EAAE,EANC;AAOTC,MAAAA,IAAI,EAAE,OAPG;AAQTC,MAAAA,oBAAoB,EAAEC,SARb;AAUT;AACAC,MAAAA,SAAS,EAAED,SAXF;AAaTE,MAAAA,cAAc,EAAE,EAbP;AAcTC,MAAAA,qBAAqB,EAAE,EAdd;AAeTC,MAAAA,qBAAqB,EAAE,EAfd;AAiBT;AACAC,MAAAA,kBAAkB,EAAE,IAlBX;AAmBTC,MAAAA,kBAAkB,EAAE,IAnBX;AAoBTC,MAAAA,sBAAsB,EAAE,IApBf;AAqBTC,MAAAA,uBAAuB,EAAE,IArBhB;AAsBTC,MAAAA,sBAAsB,EAAE,IAtBf;AAuBTC,MAAAA,uBAAuB,EAAE;AAvBhB,KAAb;AAyBH;;AAEDC,EAAAA,WAAW,CAACC,CAAD,EAAI;AACX,QAAIpB,OAAO,GAAG,KAAKD,KAAL,CAAWC,OAAzB;AACA,UAAMU,cAAc,GAAG,KAAKX,KAAL,CAAWW,cAAlC;AAEAW,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAsB,KAAKvB,KAAL,CAAWgB,sBAA7C;AACAM,IAAAA,OAAO,CAACC,GAAR,CAAY,uBAAuB,KAAKvB,KAAL,CAAWiB,uBAA9C;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAsB,KAAKvB,KAAL,CAAWkB,sBAA7C;AACAI,IAAAA,OAAO,CAACC,GAAR,CAAY,uBAAuB,KAAKvB,KAAL,CAAWmB,uBAA9C;AACAG,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAiB,KAAKvB,KAAL,CAAWc,kBAAxC;AACAQ,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAiB,KAAKvB,KAAL,CAAWe,kBAAxC;AACA,UAAMH,qBAAqB,GAAG,KAAKZ,KAAL,CAAWY,qBAAzC;AACAU,IAAAA,OAAO,CAACC,GAAR,CAAYV,qBAAZ;;AACA,SAAK,IAAIQ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKrB,KAAL,CAAWC,OAAX,CAAmBuB,MAAvC,EAA+CH,CAAC,EAAhD,EAAoD;AAChD,UAAI,KAAKrB,KAAL,CAAWC,OAAX,CAAmBoB,CAAnB,MAA0B,IAA9B,EAAoC;AAChC,YAAI,KAAKrB,KAAL,CAAWC,OAAX,CAAmBoB,CAAnB,EAAsBjB,MAAtB,KAAiC,CAArC,EAAwC;AACpC,cAAI,KAAKJ,KAAL,CAAWC,OAAX,CAAmBoB,CAAnB,EAAsBI,IAAtB,KAA+B,MAAnC,EAA2C;AACvC,gBAAIC,SAAS,GAAG,KAAK1B,KAAL,CAAWC,OAAX,CAAmBoB,CAAnB,EAAsBM,oBAAtB,CAA2CN,CAA3C,EAA8C,KAAKrB,KAAL,CAAWC,OAAzD,CAAhB;;AACA,iBAAK,IAAIoB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGK,SAAS,CAACF,MAA9B,EAAsCH,CAAC,EAAvC,EAA2C;AACvCT,cAAAA,qBAAqB,CAACgB,IAAtB,CAA2BF,SAAS,CAACL,CAAD,CAApC;AACH;AACJ,WALD,MAKO;AACH,gBAAIK,SAAS,GAAG,KAAK1B,KAAL,CAAWC,OAAX,CAAmBoB,CAAnB,EAAsBQ,aAAtB,CAAoCR,CAApC,EAAuC,KAAKrB,KAAL,CAAWC,OAAlD,CAAhB;;AACA,iBAAK,IAAIoB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGK,SAAS,CAACF,MAA9B,EAAsCH,CAAC,EAAvC,EAA2C;AACvCT,cAAAA,qBAAqB,CAACgB,IAAtB,CAA2BF,SAAS,CAACL,CAAD,CAApC;AACH;AACJ;AACJ;AACJ;AACJ;;AACD,QAAIS,CAAC,GAAGlB,qBAAqB,CAACmB,IAAtB,EAAR;AACA,UAAMC,IAAI,GAAG,EAAb;;AACA,SAAK,IAAIX,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGS,CAAC,CAACN,MAAtB,EAA8BH,CAAC,EAA/B,EAAmC;AAC/B,UAAIS,CAAC,CAACT,CAAD,CAAD,KAASS,CAAC,CAACT,CAAC,GAAG,CAAL,CAAd,EAAuB;AACnBW,QAAAA,IAAI,CAACJ,IAAL,CAAUE,CAAC,CAACT,CAAD,CAAX;AACAC,QAAAA,OAAO,CAACC,GAAR,CAAYS,IAAZ;AACH;AACJ;;AACD,SAAKC,QAAL,CAAc;AACVrB,MAAAA,qBAAqB,EAAEoB;AADb,KAAd;AAGAV,IAAAA,OAAO,CAACC,GAAR,CAAY,KAAKvB,KAAL,CAAWY,qBAAvB;AACAU,IAAAA,OAAO,CAACC,GAAR,CAAYS,IAAZ;;AAEA,QAAI,KAAKhC,KAAL,CAAWK,eAAX,KAA+B,CAAC,CAApC,EAAuC;AACnC,UAAI,CAACJ,OAAO,CAACoB,CAAD,CAAR,IAAepB,OAAO,CAACoB,CAAD,CAAP,CAAWjB,MAAX,KAAsB,KAAKJ,KAAL,CAAWI,MAApD,EAA4D;AACxD,aAAK6B,QAAL,CAAc;AAAE3B,UAAAA,MAAM,EAAE,oCAAoC,KAAKN,KAAL,CAAWI,MAA/C,GAAwD;AAAlE,SAAd;AACAH,QAAAA,OAAO,CAACoB,CAAD,CAAP,GAAapB,OAAO,CAACoB,CAAD,CAAP,CAAWa,KAAX,GAAmB,EAAE,GAAGjC,OAAO,CAACoB,CAAD,CAAP,CAAWa,KAAhB;AAAuBC,UAAAA,eAAe,EAAE;AAAxC,SAAhC,GAA+E,IAA/E;AACH,OAHD,MAGO;AACH;AACAlC,QAAAA,OAAO,CAACoB,CAAD,CAAP,CAAWa,KAAX,GAAmB,EAAE,GAAGjC,OAAO,CAACoB,CAAD,CAAP,CAAWa,KAAhB;AAAuBC,UAAAA,eAAe,EAAE;AAAxC,SAAnB,CAFG,CAE8E;AAEjF;;AACA,YAAIH,IAAJ;;AACA,YAAI/B,OAAO,CAACoB,CAAD,CAAP,CAAWI,IAAX,KAAoB,MAAxB,EAAgC;AAC5B,gBAAMW,SAAS,GAAG,KAAKA,SAAL,CAAef,CAAf,CAAlB;AACAW,UAAAA,IAAI,GAAG/B,OAAO,CAACoB,CAAD,CAAP,CAAWQ,aAAX,CAAyBR,CAAzB,EAA4BpB,OAA5B,EAAqCmC,SAArC,EAAgD,KAAKpC,KAAL,CAAWQ,oBAA3D,CAAP;AACH,SAHD,MAGO;AACHwB,UAAAA,IAAI,GAAG/B,OAAO,CAACoB,CAAD,CAAP,CAAWQ,aAAX,CAAyBR,CAAzB,EAA4BpB,OAA5B,CAAP;AACH;;AACD,aAAK,IAAIoC,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGL,IAAI,CAACR,MAAjC,EAAyCa,KAAK,EAA9C,EAAkD;AAC9C,gBAAMC,OAAO,GAAGN,IAAI,CAACK,KAAD,CAApB;AACA1B,UAAAA,cAAc,CAACiB,IAAf,CAAoBU,OAApB;AACH;;AACD,aAAK,IAAID,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAG1B,cAAc,CAACa,MAA3C,EAAmDa,KAAK,EAAxD,EAA4D;AACxD,gBAAMC,OAAO,GAAG3B,cAAc,CAAC0B,KAAD,CAA9B;;AACA,cAAIpC,OAAO,CAACqC,OAAD,CAAP,KAAqB,IAAzB,EAA+B;AAC3BrC,YAAAA,OAAO,CAACqC,OAAD,CAAP,CAAiBJ,KAAjB,GAAyB,EAAE,GAAGjC,OAAO,CAACqC,OAAD,CAAP,CAAiBJ,KAAtB;AAA6BC,cAAAA,eAAe,EAAE;AAA9C,aAAzB;AACH,WAFD,MAEO;AACHlC,YAAAA,OAAO,CAACsC,MAAR,CAAeD,OAAf,EAAwB,CAAxB,EAA2B;AAAEJ,cAAAA,KAAK,EAAE;AAAEC,gBAAAA,eAAe,EAAE;AAAnB;AAAT,aAA3B;AACH;AACJ;;AAED,aAAKF,QAAL,CAAc;AACVhC,UAAAA,OAAO,EAAEA,OADC;AAEVK,UAAAA,MAAM,EAAE,2CAFE;AAGVD,UAAAA,eAAe,EAAEgB,CAHP;AAIVV,UAAAA,cAAc,EAAEA;AAJN,SAAd;AAMH;AACJ,KApCD,MAoCO,IAAI,KAAKX,KAAL,CAAWK,eAAX,GAA6B,CAAC,CAAlC,EAAqC;AACxC;AACAJ,MAAAA,OAAO,CAAC,KAAKD,KAAL,CAAWK,eAAZ,CAAP,CAAoC6B,KAApC,GAA4C,EAAE,GAAGjC,OAAO,CAAC,KAAKD,KAAL,CAAWK,eAAZ,CAAP,CAAoC6B,KAAzC;AAAgDC,QAAAA,eAAe,EAAE;AAAjE,OAA5C;AAEA,YAAMjC,mBAAmB,GAAG,KAAKF,KAAL,CAAWE,mBAAvC;AACA,YAAMC,mBAAmB,GAAG,KAAKH,KAAL,CAAWG,mBAAvC;;AAEA,UAAIF,OAAO,CAAC,KAAKD,KAAL,CAAWK,eAAZ,CAAP,CAAoCoB,IAApC,KAA6C,MAAjD,EAAyD;AACrDxB,QAAAA,OAAO,GAAG,KAAKuC,WAAL,CAAiBvC,OAAjB,CAAV;AACA,cAAMmC,SAAS,GAAG,KAAKA,SAAL,CAAe,KAAKpC,KAAL,CAAWK,eAA1B,CAAlB;;AACA,YAAI,KAAKL,KAAL,CAAWW,cAAX,CAA0B8B,QAA1B,CAAmCpB,CAAnC,CAAJ,EAA2C;AAEvC;AACA,cAAIe,SAAS,IAAInC,OAAO,CAACoB,CAAD,CAAP,IAAc,IAA3B,KAAoC,KAAKrB,KAAL,CAAWQ,oBAAX,GAAkC,CAAlC,KAAwCa,CAAxC,IAA6C,KAAKrB,KAAL,CAAWQ,oBAAX,GAAkC,CAAlC,KAAwCa,CAAzH,CAAJ,EAAiI;AAE7H;AACA,gBAAIpB,OAAO,CAAC,KAAKD,KAAL,CAAWQ,oBAAZ,CAAP,CAAyCJ,MAAzC,KAAoD,CAAxD,EAA2D;AACvDH,cAAAA,OAAO,CAAC,KAAKD,KAAL,CAAWQ,oBAAZ,CAAP,CAAyC0B,KAAzC,GAAiD,EAAE,GAAGjC,OAAO,CAAC,KAAKD,KAAL,CAAWQ,oBAAZ,CAAP,CAAyC0B,KAA9C;AAAqDQ,gBAAAA,WAAW,EAAE;AAAlE,eAAjD;AACAxC,cAAAA,mBAAmB,CAAC0B,IAApB,CAAyB3B,OAAO,CAAC,KAAKD,KAAL,CAAWQ,oBAAZ,CAAhC;AACH,aAHD,MAIK;AACDP,cAAAA,OAAO,CAAC,KAAKD,KAAL,CAAWQ,oBAAZ,CAAP,CAAyC0B,KAAzC,GAAiD,EAAE,GAAGjC,OAAO,CAAC,KAAKD,KAAL,CAAWQ,oBAAZ,CAAP,CAAyC0B,KAA9C;AAAqDQ,gBAAAA,WAAW,EAAE;AAAlE,eAAjD;AACAvC,cAAAA,mBAAmB,CAACyB,IAApB,CAAyB3B,OAAO,CAAC,KAAKD,KAAL,CAAWQ,oBAAZ,CAAhC;AACH,aAV4H,CAY7H;;;AACAP,YAAAA,OAAO,CAACoB,CAAD,CAAP,GAAapB,OAAO,CAAC,KAAKD,KAAL,CAAWK,eAAZ,CAApB;AACAJ,YAAAA,OAAO,CAAC,KAAKD,KAAL,CAAWQ,oBAAZ,CAAP,GAA2C,IAA3C;AACAP,YAAAA,OAAO,CAAC,KAAKD,KAAL,CAAWK,eAAZ,CAAP,GAAsC,IAAtC;AAEA,iBAAKsC,UAAL;AACA,iBAAKV,QAAL,CAAc;AACV5B,cAAAA,eAAe,EAAE,CAAC,CADR;AAEVJ,cAAAA,OAAO,EAAEA,OAFC;AAGVC,cAAAA,mBAAmB,EAAEA,mBAHX;AAIVC,cAAAA,mBAAmB,EAAEA,mBAJX;AAKVG,cAAAA,MAAM,EAAE,EALE;AAMVK,cAAAA,cAAc,EAAE;AANN,aAAd;AAQH,WA1BD,MA0BO;AACH;AACA,gBAAID,SAAJ;;AACA,gBAAIT,OAAO,CAAC,KAAKD,KAAL,CAAWK,eAAZ,CAAP,CAAoCoB,IAApC,KAA6C,MAAjD,EAAyD;AACrD,kBAAIxB,OAAO,CAAC,KAAKD,KAAL,CAAWK,eAAZ,CAAP,CAAoCD,MAApC,KAA+C,CAA/C,IAAoDiB,CAAC,KAAK,KAAKrB,KAAL,CAAWK,eAAX,GAA6B,EAA3F,EAA+F;AAC3FK,gBAAAA,SAAS,GAAG,IAAZ;AACH,eAFD,MAEO,IAAIT,OAAO,CAAC,KAAKD,KAAL,CAAWK,eAAZ,CAAP,CAAoCD,MAApC,KAA+C,CAA/C,IAAoDiB,CAAC,KAAK,KAAKrB,KAAL,CAAWK,eAAX,GAA6B,EAA3F,EAA+F;AAClGK,gBAAAA,SAAS,GAAG,IAAZ;AACH;AACJ,aATE,CAWH;;;AACA,gBAAIF,oBAAoB,GAAGa,CAA3B;AAEA,iBAAKuB,sBAAL,CAA4BvB,CAA5B,EAA+BpB,OAA/B,EAAwCC,mBAAxC,EAA6DC,mBAA7D;AACAF,YAAAA,OAAO,GAAG,KAAK4C,SAAL,CAAexB,CAAf,EAAkBpB,OAAlB,CAAV;AACA,iBAAK0C,UAAL;AAEA,iBAAKV,QAAL,CAAc;AACV5B,cAAAA,eAAe,EAAE,CAAC,CADR;AAEVJ,cAAAA,OAAO,EAAEA,OAFC;AAGVK,cAAAA,MAAM,EAAE,EAHE;AAIVI,cAAAA,SAAS,EAAEA,SAJD;AAKVF,cAAAA,oBAAoB,EAAEA,oBALZ;AAMVG,cAAAA,cAAc,EAAE;AANN,aAAd;AAQH;AACJ,SAxDD,MAwDO;AACH,eAAKmC,SAAL,CAAe7C,OAAf,EAAwB,6DAAxB;AACH;AACJ,OA9DD,MA8DO,IAAIA,OAAO,CAAC,KAAKD,KAAL,CAAWK,eAAZ,CAAP,CAAoCoB,IAApC,KAA6C,MAAjD,EAAyD;AAC5DxB,QAAAA,OAAO,GAAG,KAAKuC,WAAL,CAAiBvC,OAAjB,CAAV;;AACA,YAAI,KAAKD,KAAL,CAAWW,cAAX,CAA0B8B,QAA1B,CAAmCpB,CAAnC,CAAJ,EAA2C;AACvC,eAAKuB,sBAAL,CAA4BvB,CAA5B,EAA+BpB,OAA/B,EAAwCC,mBAAxC,EAA6DC,mBAA7D;AACAF,UAAAA,OAAO,GAAG,KAAK4C,SAAL,CAAexB,CAAf,EAAkBpB,OAAlB,CAAV;AACA,eAAK0C,UAAL,GAHuC,CAKvC;;AACA,cAAI7B,kBAAkB,GAAG,KAAKd,KAAL,CAAWc,kBAApC;AACA,cAAIC,kBAAkB,GAAG,KAAKf,KAAL,CAAWe,kBAApC;;AACA,cAAId,OAAO,CAACoB,CAAD,CAAP,CAAWI,IAAX,KAAoB,MAApB,IAA8B,KAAKzB,KAAL,CAAWK,eAAX,KAA+B,EAA7D,IAAmEJ,OAAO,CAACoB,CAAD,CAAP,CAAWjB,MAAX,KAAsB,CAA7F,EAAgG;AAC5FU,YAAAA,kBAAkB,GAAG,KAArB;AACH;;AACD,cAAIb,OAAO,CAACoB,CAAD,CAAP,CAAWI,IAAX,KAAoB,MAApB,IAA8B,KAAKzB,KAAL,CAAWK,eAAX,KAA+B,CAA7D,IAAkEJ,OAAO,CAACoB,CAAD,CAAP,CAAWjB,MAAX,KAAsB,CAA5F,EAA+F;AAC3FW,YAAAA,kBAAkB,GAAG,KAArB;AACH;;AAED,eAAKkB,QAAL,CAAc;AACV5B,YAAAA,eAAe,EAAE,CAAC,CADR;AAEVJ,YAAAA,OAAO,EAAEA,OAFC;AAGVK,YAAAA,MAAM,EAAE,EAHE;AAIVK,YAAAA,cAAc,EAAE,EAJN;AAKVG,YAAAA,kBAAkB,EAAEA,kBALV;AAMVC,YAAAA,kBAAkB,EAAEA;AANV,WAAd;AAQH,SAvBD,MAuBO;AACH,eAAK+B,SAAL,CAAe7C,OAAf,EAAwB,6DAAxB;AACH;AACJ,OA5BM,MA4BA;AACHA,QAAAA,OAAO,GAAG,KAAKuC,WAAL,CAAiBvC,OAAjB,CAAV;;AACA,YAAI,KAAKD,KAAL,CAAWW,cAAX,CAA0B8B,QAA1B,CAAmCpB,CAAnC,CAAJ,EAA2C;AACvC,eAAKuB,sBAAL,CAA4BvB,CAA5B,EAA+BpB,OAA/B,EAAwCC,mBAAxC,EAA6DC,mBAA7D;AACAF,UAAAA,OAAO,GAAG,KAAK4C,SAAL,CAAexB,CAAf,EAAkBpB,OAAlB,CAAV;AACA,eAAK0C,UAAL,GAHuC,CAKvC;;AACA,cAAI3B,sBAAsB,GAAG,KAAKhB,KAAL,CAAWgB,sBAAxC;AACA,cAAIC,uBAAuB,GAAG,KAAKjB,KAAL,CAAWiB,uBAAzC;AACA,cAAIC,sBAAsB,GAAG,KAAKlB,KAAL,CAAWkB,sBAAxC;AACA,cAAIC,uBAAuB,GAAG,KAAKnB,KAAL,CAAWmB,uBAAzC;;AACA,cAAIlB,OAAO,CAACoB,CAAD,CAAP,CAAWI,IAAX,KAAoB,MAApB,IAA8B,KAAKzB,KAAL,CAAWK,eAAX,KAA+B,EAA7D,IAAmEJ,OAAO,CAACoB,CAAD,CAAP,CAAWjB,MAAX,KAAsB,CAA7F,EAAgG;AAC5FY,YAAAA,sBAAsB,GAAG,KAAzB;AACH;;AACD,cAAIf,OAAO,CAACoB,CAAD,CAAP,CAAWI,IAAX,KAAoB,MAApB,IAA8B,KAAKzB,KAAL,CAAWK,eAAX,KAA+B,EAA7D,IAAmEJ,OAAO,CAACoB,CAAD,CAAP,CAAWjB,MAAX,KAAsB,CAA7F,EAAgG;AAC5Fa,YAAAA,uBAAuB,GAAG,KAA1B;AACH;;AACD,cAAIhB,OAAO,CAACoB,CAAD,CAAP,CAAWI,IAAX,KAAoB,MAApB,IAA8B,KAAKzB,KAAL,CAAWK,eAAX,KAA+B,CAA7D,IAAkEJ,OAAO,CAACoB,CAAD,CAAP,CAAWjB,MAAX,KAAsB,CAA5F,EAA+F;AAC3Fc,YAAAA,sBAAsB,GAAG,KAAzB;AACH;;AACD,cAAIjB,OAAO,CAACoB,CAAD,CAAP,CAAWI,IAAX,KAAoB,MAApB,IAA8B,KAAKzB,KAAL,CAAWK,eAAX,KAA+B,CAA7D,IAAkEJ,OAAO,CAACoB,CAAD,CAAP,CAAWjB,MAAX,KAAsB,CAA5F,EAA+F;AAC3Fe,YAAAA,uBAAuB,GAAG,KAA1B;AACH;;AAED,eAAKc,QAAL,CAAc;AACV5B,YAAAA,eAAe,EAAE,CAAC,CADR;AAEVJ,YAAAA,OAAO,EAAEA,OAFC;AAGVK,YAAAA,MAAM,EAAE,EAHE;AAIVK,YAAAA,cAAc,EAAE,EAJN;AAKVK,YAAAA,sBAAsB,EAAEA,sBALd;AAMVC,YAAAA,uBAAuB,EAAEA,uBANf;AAOVC,YAAAA,sBAAsB,EAAEA,sBAPd;AAQVC,YAAAA,uBAAuB,EAAEA;AARf,WAAd;AAUH,SAjCD,MAiCO;AACH,eAAK2B,SAAL,CAAe7C,OAAf,EAAwB,6DAAxB;AACH;AACJ;AACJ;AACJ,GAtP6C,CAwP9C;;;AACAmC,EAAAA,SAAS,CAACW,oBAAD,EAAuB;AAC5B,QAAIX,SAAS,GAAG,KAAhB;;AACA,QAAIW,oBAAoB,GAAG,CAAvB,KAA6B,KAAK/C,KAAL,CAAWQ,oBAAxC,IAAgEuC,oBAAoB,GAAG,CAAvB,KAA6B,KAAK/C,KAAL,CAAWQ,oBAA5G,EAAkI;AAC9H,UAAI,KAAKR,KAAL,CAAWU,SAAf,EAA0B;AACtB0B,QAAAA,SAAS,GAAG,IAAZ;AACH;AACJ;;AACD,WAAOA,SAAP;AACH,GAjQ6C,CAmQ9C;;;AACAI,EAAAA,WAAW,CAACvC,OAAD,EAAU;AACjB,SAAK,IAAIoC,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAG,KAAKrC,KAAL,CAAWW,cAAX,CAA0Ba,MAAtD,EAA8Da,KAAK,EAAnE,EAAuE;AACnE,YAAMC,OAAO,GAAG,KAAKtC,KAAL,CAAWW,cAAX,CAA0B0B,KAA1B,CAAhB;;AACA,UAAIpC,OAAO,CAACqC,OAAD,CAAP,CAAiBb,IAAjB,KAA0B,MAA1B,IAAoCxB,OAAO,CAACqC,OAAD,CAAP,CAAiBb,IAAjB,KAA0B,QAA9D,IAA0ExB,OAAO,CAACqC,OAAD,CAAP,CAAiBb,IAAjB,KAA0B,MAApG,IAA8GxB,OAAO,CAACqC,OAAD,CAAP,CAAiBb,IAAjB,KAA0B,QAAxI,IAAoJxB,OAAO,CAACqC,OAAD,CAAP,CAAiBb,IAAjB,KAA0B,OAA9K,IAAyLxB,OAAO,CAACqC,OAAD,CAAP,CAAiBb,IAAjB,KAA0B,MAAvN,EAA+N;AAC3NxB,QAAAA,OAAO,CAACqC,OAAD,CAAP,CAAiBJ,KAAjB,GAAyB,EAAE,GAAGjC,OAAO,CAACqC,OAAD,CAAP,CAAiBJ,KAAtB;AAA6BC,UAAAA,eAAe,EAAE;AAA9C,SAAzB;AACH,OAFD,MAEO;AACHlC,QAAAA,OAAO,CAACqC,OAAD,CAAP,GAAmB,IAAnB;AACH;AACJ;;AACD,WAAOrC,OAAP;AACH,GA9Q6C,CAgR9C;;;AACA2C,EAAAA,sBAAsB,CAACvB,CAAD,EAAIpB,OAAJ,EAAaC,mBAAb,EAAkCC,mBAAlC,EAAuD;AACzE,QAAIF,OAAO,CAACoB,CAAD,CAAP,KAAe,IAAnB,EAAyB;AACrB,UAAIpB,OAAO,CAACoB,CAAD,CAAP,CAAWjB,MAAX,KAAsB,CAA1B,EAA6B;AACzBH,QAAAA,OAAO,CAACoB,CAAD,CAAP,CAAWa,KAAX,GAAmB,EAAE,GAAGjC,OAAO,CAACoB,CAAD,CAAP,CAAWa,KAAhB;AAAuBQ,UAAAA,WAAW,EAAE;AAApC,SAAnB;AACAxC,QAAAA,mBAAmB,CAAC0B,IAApB,CAAyB3B,OAAO,CAACoB,CAAD,CAAhC;AACH,OAHD,MAIK;AACDpB,QAAAA,OAAO,CAACoB,CAAD,CAAP,CAAWa,KAAX,GAAmB,EAAE,GAAGjC,OAAO,CAACoB,CAAD,CAAP,CAAWa,KAAhB;AAAuBQ,UAAAA,WAAW,EAAE;AAApC,SAAnB;AACAvC,QAAAA,mBAAmB,CAACyB,IAApB,CAAyB3B,OAAO,CAACoB,CAAD,CAAhC;AACH;AACJ;;AACD,SAAKY,QAAL,CAAc;AACV/B,MAAAA,mBAAmB,EAAEA,mBADX;AAEVC,MAAAA,mBAAmB,EAAEA;AAFX,KAAd;AAIH,GAhS6C,CAkS9C;;;AACA0C,EAAAA,SAAS,CAACxB,CAAD,EAAIpB,OAAJ,EAAa;AAClBA,IAAAA,OAAO,CAACoB,CAAD,CAAP,GAAapB,OAAO,CAAC,KAAKD,KAAL,CAAWK,eAAZ,CAApB;AACAJ,IAAAA,OAAO,CAAC,KAAKD,KAAL,CAAWK,eAAZ,CAAP,GAAsC,IAAtC;AACA,WAAOJ,OAAP;AACH;;AAED0C,EAAAA,UAAU,GAAG;AACT,QAAIvC,MAAM,GAAG,KAAKJ,KAAL,CAAWI,MAAX,KAAsB,CAAtB,GAA0B,CAA1B,GAA8B,CAA3C;AACA,QAAIG,IAAI,GAAG,KAAKP,KAAL,CAAWO,IAAX,KAAoB,OAApB,GAA8B,OAA9B,GAAwC,OAAnD;AACA,SAAK0B,QAAL,CAAc;AACV7B,MAAAA,MAAM,EAAEA,MADE;AAEVG,MAAAA,IAAI,EAAEA;AAFI,KAAd;AAIH,GAhT6C,CAkT9C;;;AACAuC,EAAAA,SAAS,CAAC7C,OAAD,EAAUK,MAAV,EAAkB;AACvB,SAAK2B,QAAL,CAAc;AACV3B,MAAAA,MAAM,EAAEA,MADE;AAEVD,MAAAA,eAAe,EAAE,CAAC,CAFR;AAGVM,MAAAA,cAAc,EAAE,EAHN;AAIVV,MAAAA,OAAO,EAAEA;AAJC,KAAd;AAMH;;AAED+C,EAAAA,MAAM,GAAG;AACL,wBACI;AAAA,8BACI;AAAK,QAAA,SAAS,EAAC,MAAf;AAAA,gCACI;AAAK,UAAA,SAAS,EAAC,YAAf;AAAA,iCACI,QAAC,KAAD;AACI,YAAA,OAAO,EAAE,KAAKhD,KAAL,CAAWC,OADxB;AAEI,YAAA,OAAO,EAAGoB,CAAD,IAAO,KAAKD,WAAL,CAAiBC,CAAjB;AAFpB;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,gBADJ,eAOI;AAAK,UAAA,SAAS,EAAC,WAAf;AAAA,kCACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADJ,eAEI;AAAK,YAAA,EAAE,EAAC,iBAAR;AAA0B,YAAA,KAAK,EAAE;AAAEc,cAAAA,eAAe,EAAE,KAAKnC,KAAL,CAAWO;AAA9B;AAAjC;AAAA;AAAA;AAAA;AAAA,kBAFJ,eAKI;AAAK,YAAA,SAAS,EAAC,aAAf;AAAA,sBAA8B,KAAKP,KAAL,CAAWM;AAAzC;AAAA;AAAA;AAAA;AAAA,kBALJ,eAOI;AAAK,YAAA,SAAS,EAAC,sBAAf;AAAA,mCAEK,QAAC,kBAAD;AACG,cAAA,mBAAmB,EAAE,KAAKN,KAAL,CAAWE,mBADnC;AAEG,cAAA,mBAAmB,EAAE,KAAKF,KAAL,CAAWG;AAFnC;AAAA;AAAA;AAAA;AAAA;AAFL;AAAA;AAAA;AAAA;AAAA,kBAPJ;AAAA;AAAA;AAAA;AAAA;AAAA,gBAPJ;AAAA;AAAA;AAAA;AAAA;AAAA,cADJ,eA2BI;AAAK,QAAA,SAAS,EAAC,mBAAf;AAAA,+BACI;AAAA,uCAAM;AAAA,kGAAiE;AAAG,cAAA,IAAI,EAAC,sCAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAjE,qBAA0H;AAAG,cAAA,IAAI,EAAC,gDAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAA1H,qBAAqM;AAAG,cAAA,IAAI,EAAC,gDAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAArM,uBAAyQ;AAAG,cAAA,IAAI,EAAC,sCAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAzQ,sBAAkU;AAAG,cAAA,IAAI,EAAC,8DAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAlU;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,cA3BJ;AAAA;AAAA;AAAA;AAAA;AAAA,YADJ;AAiCH;;AA9V6C","sourcesContent":["/* eslint-disable no-unused-expressions */\nimport React from 'react';\nimport '../index.css';\nimport Board from './board.js';\nimport FallenSoldierBlock from './fallensoldiers';\nimport initialiseChessBoard from '../helpers/initialiseChessBoard';\n\nexport default class Game extends React.Component {\n    constructor() {\n        super();\n        this.state = {\n            squares: initialiseChessBoard(),\n            whiteFallenSoldiers: [],\n            blackFallenSoldiers: [],\n            player: 1,\n            sourceSelection: -1,\n            status: '',\n            turn: 'white',\n            lastTurnPawnPosition: undefined,\n\n            //true === last turn enemy's pawn moved for the first time and it moved 2 squares forward. for en pasaant\n            firstMove: undefined,\n\n            highLightMoves: [],\n            allPossibleMovesWhite: [],\n            allPossibleMovesBlack: [],\n\n            //for castling\n            whiteKingFirstMove: true,\n            blackKingFirstMove: true,\n            whiteRookFirstMoveLeft: true,\n            whiteRookFirstMoveRight: true,\n            blackRookFirstMoveLeft: true,\n            blackRookFirstMoveRight: true\n        }\n    }\n\n    handleClick(i) {\n        let squares = this.state.squares;\n        const highLightMoves = this.state.highLightMoves;\n\n        console.log(\"left white rook: \" + this.state.whiteRookFirstMoveLeft);\n        console.log(\"right white rook: \" + this.state.whiteRookFirstMoveRight);\n        console.log(\"left black rook: \" + this.state.blackRookFirstMoveLeft);\n        console.log(\"right black rook: \" + this.state.blackRookFirstMoveRight);\n        console.log(\"white king: \" + this.state.whiteKingFirstMove);\n        console.log(\"black king: \" + this.state.blackKingFirstMove);\n        const allPossibleMovesWhite = this.state.allPossibleMovesWhite;\n        console.log(allPossibleMovesBlack)\n        for (let i = 0; i < this.state.squares.length; i++) {\n            if (this.state.squares[i] !== null) {\n                if (this.state.squares[i].player === 1) {\n                    if (this.state.squares[i].name === \"Pawn\") {\n                        let tempArray = this.state.squares[i].possibleCaptureMoves(i, this.state.squares);\n                        for (let i = 0; i < tempArray.length; i++) {\n                            allPossibleMovesWhite.push(tempArray[i]);\n                        }\n                    } else {\n                        let tempArray = this.state.squares[i].possibleMoves(i, this.state.squares);\n                        for (let i = 0; i < tempArray.length; i++) {\n                            allPossibleMovesWhite.push(tempArray[i]);\n                        }\n                    }\n                }\n            }\n        }\n        let x = allPossibleMovesWhite.sort();\n        const temp = [];\n        for (let i = 0; i < x.length; i++) {\n            if (x[i] !== x[i + 1]) {\n                temp.push(x[i]);\n                console.log(temp)\n            }\n        }\n        this.setState({\n            allPossibleMovesWhite: temp\n        })\n        console.log(this.state.allPossibleMovesWhite)\n        console.log(temp)\n\n        if (this.state.sourceSelection === -1) {\n            if (!squares[i] || squares[i].player !== this.state.player) {\n                this.setState({ status: \"Wrong selection. Choose player \" + this.state.player + \" pieces.\" });\n                squares[i] ? squares[i].style = { ...squares[i].style, backgroundColor: \"\" } : null;\n            } else {\n                //highlight selected piece\n                squares[i].style = { ...squares[i].style, backgroundColor: \"RGB(111,143,114)\" }; // Emerald from http://omgchess.blogspot.com/2015/09/chess-board-color-schemes.html\n                \n                //highlight possible moves\n                let temp;\n                if (squares[i].name === \"Pawn\") {\n                    const enpassant = this.enpassant(i);\n                    temp = squares[i].possibleMoves(i, squares, enpassant, this.state.lastTurnPawnPosition);\n                } else {\n                    temp = squares[i].possibleMoves(i, squares);\n                }\n                for (let index = 0; index < temp.length; index++) {\n                    const element = temp[index];\n                    highLightMoves.push(element);\n                }\n                for (let index = 0; index < highLightMoves.length; index++) {\n                    const element = highLightMoves[index];\n                    if (squares[element] !== null) {\n                        squares[element].style = { ...squares[element].style, backgroundColor: \"RGB(111,143,114)\" };\n                    } else {\n                        squares.splice(element, 1, { style: { backgroundColor: \"RGB(111,143,114)\" } });\n                    }\n                }\n                \n                this.setState({\n                    squares: squares,\n                    status: \"Choose destination for the selected piece\",\n                    sourceSelection: i,\n                    highLightMoves: highLightMoves\n                });\n            }\n        } else if (this.state.sourceSelection > -1) {\n            //dehighlight selected piece\n            squares[this.state.sourceSelection].style = { ...squares[this.state.sourceSelection].style, backgroundColor: \"\" };\n\n            const whiteFallenSoldiers = this.state.whiteFallenSoldiers;\n            const blackFallenSoldiers = this.state.blackFallenSoldiers;\n\n            if (squares[this.state.sourceSelection].name === \"Pawn\") {\n                squares = this.dehighlight(squares);\n                const enpassant = this.enpassant(this.state.sourceSelection);\n                if (this.state.highLightMoves.includes(i)) {\n\n                    //if en passant is available and player decided to use it, else proceed without it\n                    if (enpassant && squares[i] == null && (this.state.lastTurnPawnPosition - 8 === i || this.state.lastTurnPawnPosition + 8 === i)) {\n\n                        //remove captured piece border color and add it to fallen soldier list\n                        if (squares[this.state.lastTurnPawnPosition].player === 1) {\n                            squares[this.state.lastTurnPawnPosition].style = { ...squares[this.state.lastTurnPawnPosition].style, borderColor: \"transparent\" };\n                            whiteFallenSoldiers.push(squares[this.state.lastTurnPawnPosition]);\n                        }\n                        else {\n                            squares[this.state.lastTurnPawnPosition].style = { ...squares[this.state.lastTurnPawnPosition].style, borderColor: \"transparent\" };\n                            blackFallenSoldiers.push(squares[this.state.lastTurnPawnPosition]);\n                        }\n\n                        //move player selected piece to target position\n                        squares[i] = squares[this.state.sourceSelection];\n                        squares[this.state.lastTurnPawnPosition] = null;\n                        squares[this.state.sourceSelection] = null;\n\n                        this.changeTurn();\n                        this.setState({\n                            sourceSelection: -1,\n                            squares: squares,\n                            whiteFallenSoldiers: whiteFallenSoldiers,\n                            blackFallenSoldiers: blackFallenSoldiers,\n                            status: '',\n                            highLightMoves: []\n                        });\n                    } else {\n                        //check if current pawn is moving for the first time and moving 2 squares forward\n                        let firstMove;\n                        if (squares[this.state.sourceSelection].name === \"Pawn\") {\n                            if (squares[this.state.sourceSelection].player === 1 && i === this.state.sourceSelection - 16) {\n                                firstMove = true;\n                            } else if (squares[this.state.sourceSelection].player === 2 && i === this.state.sourceSelection + 16) {\n                                firstMove = true;\n                            }\n                        }\n\n                        //record current pawn position for next turn to check en passant rule\n                        let lastTurnPawnPosition = i;\n\n                        this.addToFallenSoldierList(i, squares, whiteFallenSoldiers, blackFallenSoldiers);\n                        squares = this.movePiece(i, squares);\n                        this.changeTurn();\n\n                        this.setState({\n                            sourceSelection: -1,\n                            squares: squares,\n                            status: '',\n                            firstMove: firstMove,\n                            lastTurnPawnPosition: lastTurnPawnPosition,\n                            highLightMoves: []\n                        });\n                    }\n                } else {\n                    this.wrongMove(squares, \"Wrong selection. Choose valid source and destination again.\")\n                }\n            } else if (squares[this.state.sourceSelection].name === \"King\") {\n                squares = this.dehighlight(squares);\n                if (this.state.highLightMoves.includes(i)) {\n                    this.addToFallenSoldierList(i, squares, whiteFallenSoldiers, blackFallenSoldiers);\n                    squares = this.movePiece(i, squares);\n                    this.changeTurn();\n\n                    //to record king has been moved or not. for castling\n                    let whiteKingFirstMove = this.state.whiteKingFirstMove;\n                    let blackKingFirstMove = this.state.blackKingFirstMove;\n                    if (squares[i].name === \"King\" && this.state.sourceSelection === 60 && squares[i].player === 1) {\n                        whiteKingFirstMove = false;\n                    }\n                    if (squares[i].name === \"King\" && this.state.sourceSelection === 4 && squares[i].player === 2) {\n                        blackKingFirstMove = false;\n                    }\n\n                    this.setState({\n                        sourceSelection: -1,\n                        squares: squares,\n                        status: '',\n                        highLightMoves: [],\n                        whiteKingFirstMove: whiteKingFirstMove,\n                        blackKingFirstMove: blackKingFirstMove\n                    });\n                } else {\n                    this.wrongMove(squares, \"Wrong selection. Choose valid source and destination again.\")\n                }\n            } else {\n                squares = this.dehighlight(squares);\n                if (this.state.highLightMoves.includes(i)) {\n                    this.addToFallenSoldierList(i, squares, whiteFallenSoldiers, blackFallenSoldiers);\n                    squares = this.movePiece(i, squares);\n                    this.changeTurn();\n\n                    //to record if rook has been moved or not. for castling.\n                    let whiteRookFirstMoveLeft = this.state.whiteRookFirstMoveLeft;\n                    let whiteRookFirstMoveRight = this.state.whiteRookFirstMoveRight;\n                    let blackRookFirstMoveLeft = this.state.blackRookFirstMoveLeft;\n                    let blackRookFirstMoveRight = this.state.blackRookFirstMoveRight;\n                    if (squares[i].name === \"Rook\" && this.state.sourceSelection === 56 && squares[i].player === 1) {\n                        whiteRookFirstMoveLeft = false;\n                    }\n                    if (squares[i].name === \"Rook\" && this.state.sourceSelection === 63 && squares[i].player === 1) {\n                        whiteRookFirstMoveRight = false;\n                    }\n                    if (squares[i].name === \"Rook\" && this.state.sourceSelection === 0 && squares[i].player === 2) {\n                        blackRookFirstMoveLeft = false;\n                    }\n                    if (squares[i].name === \"Rook\" && this.state.sourceSelection === 7 && squares[i].player === 2) {\n                        blackRookFirstMoveRight = false;\n                    }\n\n                    this.setState({\n                        sourceSelection: -1,\n                        squares: squares,\n                        status: '',\n                        highLightMoves: [],\n                        whiteRookFirstMoveLeft: whiteRookFirstMoveLeft,\n                        whiteRookFirstMoveRight: whiteRookFirstMoveRight,\n                        blackRookFirstMoveLeft: blackRookFirstMoveLeft,\n                        blackRookFirstMoveRight: blackRookFirstMoveRight\n                    });\n                } else {\n                    this.wrongMove(squares, \"Wrong selection. Choose valid source and destination again.\")\n                }\n            }\n        }\n    }\n\n    //to determine if its possible to do en passant capture\n    enpassant(selectedPawnPosition) {\n        let enpassant = false;\n        if (selectedPawnPosition - 1 === this.state.lastTurnPawnPosition || selectedPawnPosition + 1 === this.state.lastTurnPawnPosition) {\n            if (this.state.firstMove) {\n                enpassant = true;\n            }\n        }\n        return enpassant;\n    }\n\n    //dehighlight possible moves\n    dehighlight(squares) {\n        for (let index = 0; index < this.state.highLightMoves.length; index++) {\n            const element = this.state.highLightMoves[index];\n            if (squares[element].name === \"Pawn\" || squares[element].name === \"Knight\" || squares[element].name === \"Rook\" || squares[element].name === \"Bishop\" || squares[element].name === \"Queen\" || squares[element].name === \"King\") {\n                squares[element].style = { ...squares[element].style, backgroundColor: \"\" };\n            } else {\n                squares[element] = null;\n            }\n        }\n        return squares;\n    }\n\n    //remove captured piece border color and add it to fallen soldier list\n    addToFallenSoldierList(i, squares, whiteFallenSoldiers, blackFallenSoldiers) {\n        if (squares[i] !== null) {\n            if (squares[i].player === 1) {\n                squares[i].style = { ...squares[i].style, borderColor: \"transparent\" };\n                whiteFallenSoldiers.push(squares[i]);\n            }\n            else {\n                squares[i].style = { ...squares[i].style, borderColor: \"transparent\" };\n                blackFallenSoldiers.push(squares[i]);\n            }\n        }\n        this.setState({\n            whiteFallenSoldiers: whiteFallenSoldiers,\n            blackFallenSoldiers: blackFallenSoldiers\n        })\n    }\n\n    //move player selected piece to target position\n    movePiece(i, squares) {\n        squares[i] = squares[this.state.sourceSelection];\n        squares[this.state.sourceSelection] = null;\n        return squares;\n    }\n\n    changeTurn() {\n        let player = this.state.player === 1 ? 2 : 1;\n        let turn = this.state.turn === 'white' ? 'black' : 'white';\n        this.setState({\n            player: player,\n            turn: turn\n        })\n    }\n\n    //display message, and reset chess board\n    wrongMove(squares, status) {\n        this.setState({\n            status: status,\n            sourceSelection: -1,\n            highLightMoves: [],\n            squares: squares\n        });\n    }\n\n    render() {\n        return (\n            <div>\n                <div className=\"game\">\n                    <div className=\"game-board\">\n                        <Board\n                            squares={this.state.squares}\n                            onClick={(i) => this.handleClick(i)}\n                        />\n                    </div>\n                    <div className=\"game-info\">\n                        <h3>Turn</h3>\n                        <div id=\"player-turn-box\" style={{ backgroundColor: this.state.turn }}>\n\n                        </div>\n                        <div className=\"game-status\">{this.state.status}</div>\n\n                        <div className=\"fallen-soldier-block\">\n\n                            {<FallenSoldierBlock\n                                whiteFallenSoldiers={this.state.whiteFallenSoldiers}\n                                blackFallenSoldiers={this.state.blackFallenSoldiers}\n                            />\n                            }\n                        </div>\n\n                    </div>\n                </div>\n\n                <div className=\"icons-attribution\">\n                    <div> <small> Chess Icons And Favicon (extracted) By en:User:Cburnett [<a href=\"http://www.gnu.org/copyleft/fdl.html\">GFDL</a>, <a href=\"http://creativecommons.org/licenses/by-sa/3.0/\">CC-BY-SA-3.0</a>, <a href=\"http://opensource.org/licenses/bsd-license.php\">BSD</a> or <a href=\"http://www.gnu.org/licenses/gpl.html\">GPL</a>], <a href=\"https://commons.wikimedia.org/wiki/Category:SVG_chess_pieces\">via Wikimedia Commons</a> </small></div>\n                </div>\n            </div>\n        );\n    }\n}"]},"metadata":{},"sourceType":"module"}